FROM ubuntu:24.04
ARG VER
ENV DEBIAN_FRONTEND=noninteractive

WORKDIR /source
COPY kea-$VER.tar.* .

RUN apt-get update -y \
    && apt-get -y install --no-install-recommends \
        procps \
        make \
        socat \
        xz-utils \
        pkg-config \
        g++ \
        g++14 \
        gdb \
        flex \
        bison \
        libffi-dev \
        libboost-dev \
        libboost-system-dev \
        libssl-dev \
        libkrb5-dev \
        libreadline-dev \
        libpam-dev \
        libzstd-dev \
        liblz4-dev \
        libselinux-dev \
        libxslt-dev \
        libgtest-dev \
        liblog4cplus-dev \
        libpython3-dev \
        python3 \
        python3-pip \
        python3-setuptools \
        meson-1.5 \
        libpq-dev \
        postgresql-server-dev-all \
        libmariadb-dev \
        libmariadb-dev-compat \
    && tar xf kea-$VER.tar.* \
    && cd kea-$VER \
    && meson setup build \
    && meson compile -C build \
    && meson install -C build \
    && echo /usr/local/lib64 > /etc/ld.so.conf.d/kea.conf \
    && ldconfig
